<!DOCTYPE html>
<html lang="cs">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Konfigurátor</title>
		<style>
			*,
			*::before,
			*::after {
				box-sizing: border-box;
			}
			body {
				font-family: sans-serif;
			}
			.main {
				max-width: 80ex;
				margin: 0 auto;
			}
			label,
			button {
				display: block;
				cursor: pointer;
			}
			label + label {
				margin-top: 1.5em;
			}
			textarea,
			input,
			button {
				width: 100%;
				font-size: 2em;
			}
			textarea {
				resize: vertical;
				min-height: 3em;
				font-size: 3em;
			}
			button {
				margin-top: 1em;
			}
			.preview {
				position: relative;
				margin-bottom: 2em;
				overflow: hidden;
			}
			.preview::before {
				content: '';
				display: block;
				padding-top: calc(100% / (16 / 9));
			}
			.preview-in {
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				border: none;
			}
		</style>
	</head>
	<body>
		<main class="main">
			<h1>Czechitas konfigurátor stream scén</h1>
			<div class="preview">
				<iframe
					src="scena.html?title=Náhled"
					class="preview-in"
					id="preview"
				></iframe>
			</div>
			<form action="scena.html">
				<label>
					Nadpis:
					<br />
					<textarea name="title"></textarea>
				</label>
				<label>
					Meta 1:
					<br />
					<input name="meta1" autocomplete="name" />
				</label>
				<label>
					Meta 2:
					<br />
					<input name="meta2" />
				</label>
				<label>
					Meta 3:
					<br />
					<input name="meta3" autocomplete="address-level2" />
				</label>
				<label>
					Icon url:
					<br />
					<input type="url" name="icon" />
				</label>
				<button type="submit">Zobrazit</button>
			</form>
		</main>
		<script>
			const STORAGE_KEY = 'last-data'
			const $form = document.querySelector('form')
			const $preview = document.querySelector('#preview')
			$form.addEventListener('submit', (event) => {
				const formData = new FormData($form)
				const data = {}
				for (let [name, value] of formData.entries()) {
					data[name] = value
				}
				localStorage.setItem(STORAGE_KEY, JSON.stringify(data))
			})
			$form.addEventListener(
				'input',
				(() => {
					let timer
					return (event) => {
						clearTimeout(timer)
						timer = setTimeout(() => {
							const formData = new FormData($form)
							const parameters = [...formData.entries()]
								.map(
									(x) =>
										`${encodeURIComponent(x[0])}=${encodeURIComponent(x[1])}`,
								)
								.join('&')
							$preview.setAttribute(
								'src',
								`${$form.getAttribute('action')}?${parameters}`,
							)
						}, 500)
					}
				})(),
			)

			try {
				const data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {}
				for (let [name, value] of Object.entries(data)) {
					const $field = $form.querySelector(`[name="${name}"]`)
					if (!$field.value) {
						$field.value = value
					}
				}
			} catch (error) {
				console.error(error)
			}
		</script>
	</body>
</html>
